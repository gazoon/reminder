main:
  - goto:
      - if: {{eq .State "title"}}
        then: enter_title
      - if: {{eq .State "date"}}
        then: enter_date
      - if: {{eq .State "description"}}
        then: enter_description
      - if: {{eq .State "attachment"}}
        then: add_attachment

parts:
  enter_title:
    - set_input_handler: "on_title"
    - send_text:
        {{if eq .ErrorMsg ""}}
        "Enter title."
        {{else}}
        "Problems with title: {{.ErrorMsg}}. Type again."
        {{end}}

  enter_date:
    - set_input_handler: "on_date"
    - send_text:
        {{if eq .ErrorMsg ""}}
        "Enter date."
        {{else}}
        "Problems with date: {{.ErrorMsg}}. Type again."
        {{end}}

  enter_description:
    - set_input_handler: "on_description"
    - send_text:
        {{if eq .ErrorMsg ""}}
        "Enter Description (optional)."
        {{else}}
        "Problems with description: {{.ErrorMsg}}. Type again."
        {{end}}
    - send_buttons:
        - { text: "Done", handler: "page://finish_creation", intents: ["done","ready","finish"] }

  add_attachment:
    - send_text:
        {{if eq .ErrorMsg ""}}
        "Upload attachment (optional)."
        {{else}}
        "Problems with attachment: {{.ErrorMsg}}. Upload again."
        {{end}}
    - send_buttons:
        - { text: "Done", handler: "page://finish_creation", intents: ["done","ready","finish"] }

intents:
  - words: ["cancel","close","exit","escape"]
    handler: "page://finish_creation?cancel=true"
