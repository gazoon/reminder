actions:
  input_routing:
    - goto:
        cond:
          - { if: '{{eq .part "title"}}', then: enter_title }
          - { if: '{{eq .part "date"}}', then: enter_date }
          - { if: '{{eq .part "description"}}', then: enter_description }
          - { if: '{{eq .part "attachment"}}', then: add_attachment }

  enter_title:
    - set_input_handler: "on_title"
    - send_text:
        {{if eq .error_msg ""}}
        "Enter title."
        {{else}}
        "Problems with title: {{.ErrorMsg}}. Type again."
        {{end}}

  on_title:
    - redirect: "enter_date"

  enter_date:
    - set_input_handler: "on_date"
    - send_text:
        {{if eq .error_msg ""}}
        "Enter date."
        {{else}}
        "Problems with date: {{.ErrorMsg}}. Type again."
        {{end}}

  on_date:
    - redirect: "enter_description"

  enter_description:
    - set_input_handler: "on_description"
    - send_text:
        {{if eq .error_msg ""}}
        "Enter Description (optional)."
        {{else}}
        "Problems with description: {{.ErrorMsg}}. Type again."
        {{end}}
    - send_buttons:
      - { text: "Skip", handler: "add_attachment", intents: ["skip","next"] }
      - { text: "Done", handler: "done", intents: ["done","ready","finish"] }

  on_description:
    - redirect: "add_attachment"

  add_attachment:
    - send_text:
        {{if eq .error_msg ""}}
        "Upload attachment (optional)."
        {{else}}
        "Problems with attachment: {{.ErrorMsg}}. Upload again."
        {{end}}
    - send_buttons:
      - { text: "Done", handler: "done", intents: ["done","ready","finish"] }

  on_attachment:
    - redirect: "add_attachment"

  done:
    - send_text: "Reminder successfully created."
    - send_buttons:
      - { text: "Home", handler: "page://home", intents:["home","root","main"] }

  cancel:
    - redirect: "page://home"

entry_action: input_routing

intents:
  - words: ["cancel","close","exit","escape"]
    handler: "cancel"
